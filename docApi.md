
# Documentación de la Aplicación - Gestión de Vulnerabilidades NIST

## Índice

 
1. Descripción general
2. Arquitectura del proyecto
3. Entorno de desarrollo y despliegue
4. Instalación y configuración
5. Endpoints de la API
6. Cómo ejecutar los endpoints en Postman
7. Manejo del caché con Redis
8. Dockerización
  

### 1. Descripción General

  

Esta aplicación es una API REST desarrollada en Django y Django REST framework que se conecta con la API del NIST (National Institute of Standards and Technology) para gestionar vulnerabilidades (CVE). Los usuarios pueden listar las vulnerabilidades, marcar como fixeadas, consultar por vulnerabilidades fixeadas y no fixeadas, consultar fix exactos y obtene un resumen de las vulnerabilidades por nivel de severidad.


Además, la aplicación utiliza Redis como backend de caché para optimizar el tiempo de respuesta de las consultas a la API.

### 2. Arquitectura del Proyecto

  

 - Django: Framework principal utilizado para el desarrollo de la API.}
 - Django REST framework: Utilizado para la creación de los endpoints de
   la API.
 - PostgreSQL: Base de datos utilizada para almacenar las
   vulnerabilidades.
 - Redis: Utilizado como caché para mejorar el rendimiento de las
   consultas a la API del NIST.
 - Docker: La aplicación está completamente dockerizada para facilitar
   su despliegue y desarrollo en cualquier entorno.

### 3. Entorno de Desarrollo y Despliegue

#### Requisitos:

> Docker: Herramienta de contenedorización para ejecutar la aplicación.
Docker Compose: Utilizado para orquestar los servicios necesarios como Django, PostgreSQL y Redis.
Python 3.9: El proyecto está configurado para Python 3.9.

  

#### Configuración:

  

##### Clonar el repositorio:

  
    git clone https://github.com/tu_usuario/nist-api-repo.git
    cd nist-api-repo

##### Configurar la API Key del NIST:

  

Crear un archivo .env en la raíz del proyecto e incluir tu clave API:


    echo "NIST_API_KEY=tu_apikey_aqui" > .env

  

Levantar el proyecto con Docker:


    docker-compose up --build

  

### 4. Instalación y Configuración

  

Instalar las dependencias: Asegúrate de que las dependencias están correctamente instaladas. Estas están gestionadas en el archivo requirements.txt, y Docker las instalará automáticamente cuando se ejecute el comando docker-compose up.

> Configuración de la base de datos: La base de datos utilizada es
> PostgreSQL, que se levanta como parte de Docker Compose. Los detalles
> de conexión están predefinidos en el archivo docker-compose.yml.

  

### 5. Endpoints de la API

#### -1. GET /api/v1/vulnerabilities/

  

Este endpoint consulta la API del NIST, obtiene vulnerabilidades y las almacena en la base de datos local. Si ya existen, las actualiza sin cambiar el estado de is_fixed si ya está marcado como True.

Respuesta:

      [
        
    	   {
    	    
    	    "cve_id": "CVE-2021-12345",
    	    
    	    "description": "Descripción de la vulnerabilidad",
    	    
    	    "severity": "Critical",
    	    
    	    "is_fixed": false
    	    
    	    },
    	    
    	    ...
        
    ]

  

#### -2. POST /api/v1/vulnerabilities/fix/

  

Este endpoint permite marcar vulnerabilidades como fixeadas o desmarcarlas.

Cuerpo de la solicitud:


    {
    
    "cve_ids": ["CVE-2021-12345", "CVE-2022-67890"],
    
    "is_fixed": true
    
    }

  

Respuesta:


    {
    
    "message": "Vulnerabilidades actualizadas y caché sincronizado."
    
    }

  

#### -3. GET /api/v1/vulnerabilities/unfixed/
#### GET /api/v1/vulnerabilities/fixed/

Devuelve todas las vulnerabilidades que no han sido fixeadas.
Devuelve todas las vulnerabilidades que han sido fixeadas.


#### -4. **GET /api/v1/vulnerabilities/<cve_id>/**
Devuelve la información de una vulnerabilidad exacta segun el cve_id.

-   **URL**: `http://localhost:8000/api/v1/vulnerabilities/CVE-2022-12345/`
    
-   **Método HTTP**: `GET`
    
-   **Respuesta**: El detalle de un CVE en especifico

#### -5. GET /api/v1/vulnerabilities/severity-summary/

Devuelve un resumen del número de vulnerabilidades por severidad.



### Ejecutar los Endpoints en Postman

Para probar los endpoints en Postman, sigue los siguientes pasos:

 
#### Configuración básica de la URL base:

La URL base de la API cuando la corras localmente será:


> http://localhost:8000/api/v1/

  

##### GET /api/v1/vulnerabilities/ en Postman:

URL: http://localhost:8000/api/v1/vulnerabilities/

No necesitas enviar datos adicionales.

Respuesta esperada:

    [
    
    {
    
    "cve_id": "CVE-2021-12345",
    
    "description": "Descripción de la vulnerabilidad",
    
    "severity": "Critical",
    
    "is_fixed": false
    
    },
    
    ...
    
    ]

  

##### POST /api/v1/vulnerabilities/fix/ en Postman:
Método: POST
URL: http://localhost:8000/api/v1/vulnerabilities/fix/

Cuerpo: En la pestaña "Body" de Postman, selecciona "raw" y elige el tipo JSON, luego pega el siguiente JSON:

    {
    
    "cve_ids": ["CVE-1999-0095", "CVE-1999-0082", "CVE-1999-1122"],
    "is_fixed": true
    
    }

  o

    {
        
        "cve_ids": ["CVE-1999-0095", "CVE-1999-0082", "CVE-1999-1122"],
        "is_fixed": false
        
    }

Respuesta esperada:

    {
    
    "message": "Vulnerabilidades actualizadas y caché sincronizado."
    
    }

  

##### GET /api/v1/vulnerabilities/unfixed/ en Postman:
##### GET /api/v1/vulnerabilities/fixed/ en Postman:

Método: GET

URL: http://localhost:8000/api/v1/vulnerabilities/unfixed/
		http://localhost:8000/api/v1/vulnerabilities/fixed/
No necesitas enviar datos adicionales.

Respuesta esperada

    [
    
    {
    
    "cve_id": "CVE-2021-67890",
    
    "description": "Descripción de la vulnerabilidad",
    
    "severity": "High",
    
    "is_fixed": false
    
    },
    
    ...
    
    ]


##### **GET /api/v1/vulnerabilities/<cve_id>/**

Este endpoint devuelve los detalles de una vulnerabilidad específica proporcionada por su CVE ID.
  
Método: GET

URL: http://localhost:8000/api/v1/vulnerabilities/CVE-1999-0095/

No necesitas enviar datos adicionales. el cve_id va como un parametro de la URL

Respuesta esperada:

  El detalle de un CVE en especifico

##### GET /api/v1/vulnerabilities/severity-summary/ en Postman:

Método: GET

URL: http://localhost:8000/api/v1/vulnerabilities/severity-summary/



Respuesta esperada: 

    {
    
    "Critical": 5,
    
    "High": 10,
    
    "Medium": 15,
    
    "Low": 3
    
    }

  

### 6. Manejo del Caché con Redis

  

La aplicación utiliza Redis para almacenar en caché las vulnerabilidades consultadas desde el NIST. Esto mejora significativamente el rendimiento al evitar llamadas repetidas a la API externa.

#### Flujo de uso del caché:

  

##### Consulta de vulnerabilidades:

Cuando un usuario realiza una solicitud GET /api/v1/vulnerabilities/, primero se verifica si los datos están en caché.

Si los datos están en caché, se devuelven desde Redis.

Si no, se hace una consulta a la API del NIST, se almacenan los datos en la base de datos y en el caché.

  

##### Actualización del caché:

Cuando se actualiza el estado de una vulnerabilidad (por ejemplo, al marcarla como fixeada), el caché también se actualiza para mantener los datos consistentes.

  

### 7. Dockerización

La aplicación está completamente dockerizada, lo que significa que puedes ejecutarla en cualquier entorno con Docker y Docker Compose.

##### Servicios en Docker Compose:

web: Contenedor que ejecuta la aplicación Django.

db: Contenedor que ejecuta PostgreSQL.

redis: Contenedor que ejecuta Redis como backend de caché.

  

#### Comandos útiles:
Levantar los servicios:

    docker-compose up --build
Detener los servicios:


    docker-compose down


Verificar los contenedores corriendo:


    docker ps


Con los servicios arriba se podra validar el uso de la api en:

> localhost:8000/api/v1/

